switch.p4
=========

The switch.p4 program describes a data plane of an L2/L3 switch.

Supported Features
------------------
1. Basic L2 Switching: Flooding, learning and STP
2. L2 Multicast
3. Basic L3 Routing (unicast): IPv4 and IPv6 and VRF
4. L3 Multicast
5. LAG
6. ECMP
7. Tunneling: VXLAN and NVGRE (including L2/L3 Gateway), Geneve, GRE and IPinIP
8. Basic ACL: MAC and IP ACLs
9. Unicast RPF check
10. MPLS: LER, LSR, IPVPN, VPLS, L2VPN
11. Host interface
12. Mirroring: Ingress and egress mirroring with ERSPAN
13. Counters/Statistics
14. Ingress Policers
15. Inband Network Telemetry (INT)

Upcoming Features
-----------------
1. NAT
2. QoS


## Run with Klee

`klee --max-time 600 --search=dfs --optimize switch_16-org.bc`

`switch_16-org.c` is generated by original assert-p4. `switch_16.c` is generated by our modified assert-p4, it is not complete since we haven't totally implement that. Thus, we use the original program.

Use `runquery.py` to query the result periodically. Use `parseQuery.py` to parse the query.


## Result

Running with 2 packets on ds05

- using `klee --max-time 3600 --search=dfs --optimize switch_16-org.bc`
```
-------------------------------------------------------------------------
|  Path   |   Instrs|  Time(s)|  ICov(%)|  BCov(%)|  ICount|  TSolver(%)|
-------------------------------------------------------------------------
|klee-last|211262674|  3600.21|    22.25|    25.15|   10727|       55.14|
-------------------------------------------------------------------------
```
- using `klee --max-time 3600 --search=nurs:covnew --max-solver-time 30 switch_16-org.bc`
```
------------------------------------------------------------------------
|  Path   |  Instrs|  Time(s)|  ICov(%)|  BCov(%)|  ICount|  TSolver(%)|
------------------------------------------------------------------------
|klee-last|  121849|  2532.72|    14.54|    40.88|   17881|       87.67|
------------------------------------------------------------------------
```

Running with 3 packets on ds05
- using `klee --max-time 3600 --search=nurs:covnew --max-solver-time 30 switch_16-org.bc`
```
------------------------------------------------------------------------
|  Path   |  Instrs|  Time(s)|  ICov(%)|  BCov(%)|  ICount|  TSolver(%)|
------------------------------------------------------------------------
|klee-last|  109616|  2729.78|    12.66|    36.25|   17881|       60.93|
------------------------------------------------------------------------
```



Running with 1 packet on ds06

- using `klee --max-time 3600 --search=nurs:covnew switch_16-org.bc`
```
------------------------------------------------------------------------
|  Path   |  Instrs|  Time(s)|  ICov(%)|  BCov(%)|  ICount|  TSolver(%)|
------------------------------------------------------------------------
|klee-last|   62787|  1599.99|    12.82|    37.62|   17881|       20.55|
------------------------------------------------------------------------
```

- using `klee --max-time 3600 --search=nurs:covnew --max-solver-time 30 switch_16-org.bc`
```
------------------------------------------------------------------------
|  Path   |  Instrs|  Time(s)|  ICov(%)|  BCov(%)|  ICount|  TSolver(%)|
------------------------------------------------------------------------
|klee-last|   84095|  1686.78|    12.90|    37.62|   17881|       79.34|
------------------------------------------------------------------------

```

Running with 2 packet on ds06

- using `klee --max-time 3600 --search=nurs:covnew --max-solver-time 30 switch_16-org.bc`
```
------------------------------------------------------------------------
|  Path   |  Instrs|  Time(s)|  ICov(%)|  BCov(%)|  ICount|  TSolver(%)|
------------------------------------------------------------------------
|klee-last|  110996|  3602.46|    13.90|    41.25|   17881|       60.98|
------------------------------------------------------------------------
```
